# xteve-channel-alerts

### Why?
Sometimes when you sit down to watch a specific channel you discover it has vanished from your xTeVe playlist.  
xTeVe refreshes the playlist nightly; **xteve-channel-alerts** runs **after** that update and compares
today‚Äôs channel list to yesterday‚Äôs.  
If any channels disappeared it sends a rich-embed message to a Discord webhook.

---

## Multi-Architecture Support ‚úÖ

The Docker image `celsian/xteve-channel-alerts:latest` is published as a **multi-arch image**.  
Docker (and Unraid) automatically pull the correct build:

| Architecture | Typical hosts / CPUs                | Docker platform |
|--------------|-------------------------------------|-----------------|
| **AMD64**    | Intel / AMD 64-bit PCs & servers    | `linux/amd64`   |
| **ARM64**    | Apple Silicon (M1/M2/M3) & ARM SBCs | `linux/arm64`   |

No flags are required‚ÄîDocker fetches the right image.

---

## Quick-start (single run)

```bash
docker run -d \
  --name xteve-channel-alerts \
  -e XTEVE_URL="http://192.168.1.100:34400/m3u/xteve.m3u" \
  -e DISCORD_WEBHOOK_URL="https://discord.com/api/webhooks/‚Ä¶" \
  -e CRON_SCHEDULE="0 4 * * *" \
  -v /path/to/appdata:/app/data \
  celsian/xteve-channel-alerts:latest
```

`/path/to/appdata` is a **single directory** that the container organises like:

```
data/
‚îú‚îÄ‚îÄ logs/   ‚îÄ‚îÄ‚ñ∂  app.log , cron.log
‚îî‚îÄ‚îÄ m3us/   ‚îÄ‚îÄ‚ñ∂  current.m3u , previous.m3u
```

---

## docker-compose example

```yaml
version: '3'
services:
  xteve-channel-alerts:
    image: celsian/xteve-channel-alerts:latest
    container_name: xteve-channel-alerts
    environment:
      XTEVE_URL: http://192.168.1.100:34400/m3u/xteve.m3u
      DISCORD_WEBHOOK_URL: https://discord.com/api/webhooks/‚Ä¶
      CRON_SCHEDULE: 0 4 * * *        # daily at 04:00
    volumes:
      - ./data:/app/data              # organised sub-dirs: logs/  m3us/
    restart: unless-stopped
```

---

## Environment variables

| Variable               | Required | Default     | Description                                         |
|------------------------|----------|-------------|-----------------------------------------------------|
| `XTEVE_URL`            | ‚úî        | ‚Äî           | URL to the M3U generated by xTeVe                   |
| `DISCORD_WEBHOOK_URL`  | ‚úî        | ‚Äî           | Discord webhook that receives alerts                |
| `CRON_SCHEDULE`        | ‚úñ        | `0 4 * * *` | Standard 5-field cron string controlling run times  |

---

## Volume mapping

| Container path | Contains ‚Ä¶                                                                     | Must persist? | Example host path                         |
|----------------|--------------------------------------------------------------------------------|---------------|-------------------------------------------|
| `/app/data`    | `logs/` ‚Üí `app.log`, `cron.log`  &nbsp;‚Ä¢&nbsp; `m3us/` ‚Üí `current.m3u`, `previous.m3u` | **Yes**       | `/mnt/user/appdata/xteve-channel-alerts`  |

If this volume is **not** mapped persistently the container will treat every
run as the first run and logs will be lost.

---

## Cron schedule

`CRON_SCHEDULE` accepts any standard five-field cron expression:

| Example        | Meaning          |
|----------------|------------------|
| `*/30 * * * *` | every 30 minutes |
| `15 2 * * *`   | daily at 02:15   |
| `0 */6 * * *`  | every 6 hours    |

Change the variable and restart the container to apply.

---

## Troubleshooting

| Symptom                                    | Likely cause / fix                                                                                 |
|--------------------------------------------|----------------------------------------------------------------------------------------------------|
| No Discord messages                        | Incorrect webhook URL or outbound network blocked                                                  |
| ‚ÄúPrevious m3u file not found‚Äù every run    | `/app/data` not mapped persistently                                                                |
| Cron appears to do nothing                 | Mis-typed `CRON_SCHEDULE`; validate with an online cron tester                                     |
| `xTeVe: cannot GET ‚Ä¶` errors               | xTeVe URL unreachable from container; use IP or set `network_mode: host`                           |
| Discord message truncated                  | Discord embeds limited to ~7 kB; see full list in `app.log`                                        |

---

## Updating & backup

* **Update** ‚Äì pull the new image and restart; `/app/data` retains state  
* **Backup** ‚Äì copy `/mnt/user/appdata/xteve-channel-alerts/` to preserve logs
  and the previous M3U snapshot

Happy monitoring üéâ
