# xTeVe Channel Alerts

`xTeVe-Channel-Alerts` is a small Go service that downloads the latest M3U
playlist from your xTeVe instance, compares it with the previous day’s list,
and sends a Discord embed message when channels disappear.  
Typical use-case: get an early warning that an IPTV provider has silently
dropped stations so you can act before users complain.

---

## Docker Usage ⭐️

The recommended way to run the app is inside a lightweight Docker container
published to Docker Hub (or built locally).

### Quick start

```bash
docker run -d \
  --name xteve-channel-alerts \
  -e XTEVE_URL="http://192.168.1.100:34400/m3u/xteve.m3u" \
  -e DISCORD_WEBHOOK_URL="https://discord.com/api/webhooks/…" \
  -e CRON_SCHEDULE="0 4 * * *" \
  -v /path/to/appdata/tmp:/app/file/tmp \
  -v /path/to/appdata/logs:/app/log \
  ghcr.io/youruser/xteve-channel-alerts:latest
```

The container starts `crond` in the foreground and triggers the check on the
schedule you supply via `CRON_SCHEDULE`.

---

## Building the Image Locally

```bash
# build the multi-stage image
docker build -t xteve-channel-alerts:latest .

# (optional) tag & push
docker tag xteve-channel-alerts:latest yourdockerhubuser/xteve-channel-alerts:latest
docker push yourdockerhubuser/xteve-channel-alerts:latest
```

A helper script `build-docker.sh` is included to automate version tagging and
pushing.

---

## docker-compose Example

```yaml
version: '3'
services:
  xteve-channel-alerts:
    image: yourdockerhubuser/xteve-channel-alerts:latest
    container_name: xteve-channel-alerts
    environment:
      XTEVE_URL: http://192.168.1.100:34400/m3u/xteve.m3u
      DISCORD_WEBHOOK_URL: https://discord.com/api/webhooks/…
      CRON_SCHEDULE: 0 4 * * *
    volumes:
      - ./data/tmp:/app/file/tmp
      - ./data/logs:/app/log
    restart: unless-stopped
```

---

## Environment Variables

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `XTEVE_URL` | ✔ | — | URL to the M3U generated by your xTeVe instance. |
| `DISCORD_WEBHOOK_URL` | ✔ | — | Discord webhook where alerts will be posted. |
| `CRON_SCHEDULE` | ✖ | `0 4 * * *` | Standard 5-field cron string controlling when the check runs. |

---

## Volume Mapping

| Container Path | Purpose | Must Persist? |
|----------------|---------|---------------|
| `/app/file/tmp` | Stores `current.m3u` and `previous.m3u` so the diff works across restarts. | ✅ Yes |
| `/app/log` | Combined application & cron logs. | Optional but recommended |

---

## Cron Job Configuration

The container’s entrypoint rewrites `/etc/cron.d/xteve-cron` on every start
using the value of `CRON_SCHEDULE`.  
Examples:

| Schedule | Effect |
|----------|--------|
| `*/30 * * * *` | every 30 minutes |
| `15 2 * * *` | daily at 02:15 |
| `0 */6 * * *` | every 6 hours |

Change the variable, restart the container, and the new schedule is active.

---

## Unraid Community Apps Integration

An Unraid template (`unraid/template/xteve-channel-alerts.xml`) is provided so
you can install the container through **Community Apps** in two clicks.

1. In Community Apps, open “Install from URL” and paste the raw template URL:  
   `https://raw.githubusercontent.com/celsian/xteve-channel-alerts/main/unraid/template/xteve-channel-alerts.xml`
2. Fill out the following fields:
   * `XTEVE_URL` – your xTeVe playlist link  
   * `DISCORD_WEBHOOK_URL` – Discord webhook
   * `CRON_SCHEDULE` – when to run (optional)
3. Map the two paths:
   * `/mnt/user/appdata/xteve-channel-alerts/tmp` → `/app/file/tmp`
   * `/mnt/user/appdata/xteve-channel-alerts/logs` → `/app/log`
4. Click **Deploy**.

The container will send a “first run” message to Discord and will run
according to the schedule from then on.

---

## Support

* Open an issue: <https://github.com/celsian/xteve-channel-alerts/issues>
* Pull requests are welcome!
